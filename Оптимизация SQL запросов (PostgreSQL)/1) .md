# Оптимизация

Оптимизация означает любое преобразование, улучшающее производительность системы.  
Основной источник проблемы в том, что SQL – **декларативный язык**. Это означает, что когда мы пишем инструкцию SQL, то описываем результат, который хотим получить, но не указываем, как он должен быть получен.  
оптимизатор базы данных выбирает лучший способ выполнить запрос. Что значит «лучший», определяется множеством различных факторов, таких как структура хранения, индексы и статистика.
Рассмотрим простой пример. Взгляните на запросы из листингов.  
```Листинг 1.1```
```
SELECT flight_id,
       departure_airport,
       arrival_airport
  FROM flight
 WHERE scheduled_arrival BETWEEN '2020-10-14' AND '2020-10-15';
```
<br>

```Листинг 1.2```
```
SELECT flight_id,
 departure_airport,
 arrival_airport
 FROM flight
 WHERE scheduled_arrival::date = '2020-10-14';
```
<br>

Эти два запроса выглядят почти одинаково и должны давать одинаковые результаты. Тем не менее время выполнения будет разным, потому что работа, выполняемая движком базы данных, будет различаться.  
<br>

До сих пор подразумевалось, что эффективный запрос – это запрос, который выполняется быстро. Однако это определение не является точным или полным. Даже если на мгновение мы сочтем сокращение времени выполнения единственной целью оптимизации, остается вопрос: какое время выполнения является «достаточно хорошим»?  
Кроме того, для одного и того же запроса время выполнения может варьироваться в разное время дня или в зависимости от загрузки базы данных. В  некоторых случаях нас может интересовать среднее время выполнения.Если у системы жесткий тайм-аут, нам может понадобиться измерить производительность, ограничив максимальное время исполнения. Есть также субъективная составляющая при измерении времени отклика. Однако помимо времени выполнения могут быть приняты во внимание и другие характеристики. Например, поставщик услуг может быть заинтересован в  максимальном увеличении пропускной способности системы. Небольшой стартап может быть заинтересован в  минимизации использования ресурсов без ущерба для времени отклика системы.  
SQL-запрос нельзя оптимизировать изолированно, вне контекста его назначения и окружения, в котором он выполняется. Поскольку запросы можно писать не декларативно, первоначальная цель запроса может быть неочевидной. Выяснение того, что должно быть сделано с точки зрения бизнеса, – возможно, первый и самый важный шагоптимизации. Более того, вопросы о цели отчета могут привести к выводу, что отчет вообще не нужен.  

